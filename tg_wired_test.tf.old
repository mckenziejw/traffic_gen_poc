terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "3.0.2"
    }
  }
}
provider "docker" {
  alias    = "client1"
  host     = "ssh://root@desktop1-mgmt:22"
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]
}

resource "docker_network" "lan_1" {
    provider = docker.client1
    name = "lan"
    driver = "ipvlan"

    ipam_config {
        subnet = "10.99.99.0/24"
        ip_range = "10.99.99.0/24"
        gateway = "10.99.99.1"
    }
    options = {
        parent = "ens192"
        ipvlan_mode = "l2"
    }
}

resource "docker_network" "mgmt_1" {
    provider = docker.client1
    name = "mgmt"
    driver = "ipvlan"

    ipam_config {
        subnet = "192.168.10.0/24"
        ip_range = "192.168.10.0/24"
        gateway = "192.168.10.1"
    }
    options = {
        parent = "ens160"
        ipvlan_mode = "l2"
    }
}


data "docker_registry_image" "web_client_1"{
    provider = docker.client1
    name = "autofunbot/tg_web_client:latest"
}

resource "docker_image" "web_client_1" {
    provider = docker.client1
    name = data.docker_registry_image.web_client_1.name
    pull_triggers = [data.docker_registry_image.web_client_1.sha256_digest]
}
resource "docker_container" "web_client_1" {
    provider = docker.client1
    name = "web-client"
    image = docker_image.web_client_1.image_id
    hostname = "web-client-1"
   
    shm_size = 2048
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["INTERVAL=5","MQTT_SERVER=mqtt-server-1-mgmt","TARGETS=web-server-2"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.99.99.100"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.111"
    }
    depends_on = ["docker_network.lan_1","docker_container.mqtt_server_1","docker_image.web_client_1","docker_network.mgmt_1"]
    
}

data "docker_registry_image" "web_server_1"{
    provider = docker.client1
    name = "autofunbot/tg_web_server:latest"
}

resource "docker_image" "web_server_1" {
    provider = docker.client1
    name = data.docker_registry_image.web_server_1.name
    pull_triggers = [data.docker_registry_image.web_server_1.sha256_digest]
}
resource "docker_container" "web_server_1" {
    provider = docker.client1
    name = "web-server"
    image = docker_image.web_server_1.image_id
    hostname = "web-server-1"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["TARGETS=web-server-2","PORT=80"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.99.99.2"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.112"
    }
    depends_on = ["docker_network.lan_1","docker_network.mgmt_1"]
    
}

data "docker_registry_image" "mqtt_server_1"{
    provider = docker.client1
    name = "eclipse-mosquitto"
}

resource "docker_image" "mqtt_server_1" {
    provider = docker.client1
    name = data.docker_registry_image.mqtt_server_1.name
    pull_triggers = [data.docker_registry_image.mqtt_server_1.sha256_digest]
}
resource "docker_container" "mqtt_server_1" {
    provider = docker.client1
    name = "mqtt-server"
    image = docker_image.mqtt_server_1.image_id
    hostname = "mqtt-server-1"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    networks_advanced {
        name = "lan"
        ipv4_address = "10.99.99.7"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.117"
    }
    depends_on = ["docker_network.lan_1","docker_network.mgmt_1"]
    
    
    mounts {
        target = "/mosquitto/config/mosquitto.conf",
        source = "/home/lab/mosquitto/mosquitto.conf",
        type = "bind"
    }
    
    
}

provider "docker" {
  alias    = "client2"
  host     = "ssh://root@desktop2-mgmt:22"
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]
}

resource "docker_network" "lan_2" {
    provider = docker.client2
    name = "lan"
    driver = "ipvlan"

    ipam_config {
        subnet = "10.88.88.0/24"
        ip_range = "10.88.88.0/24"
        gateway = "10.88.88.1"
    }
    options = {
        parent = "ens192"
        ipvlan_mode = "l2"
    }
}

resource "docker_network" "mgmt_2" {
    provider = docker.client2
    name = "mgmt"
    driver = "ipvlan"

    ipam_config {
        subnet = "192.168.10.0/24"
        ip_range = "192.168.10.0/24"
        gateway = "192.168.10.1"
    }
    options = {
        parent = "ens160"
        ipvlan_mode = "l2"
    }
}


data "docker_registry_image" "web_client_2"{
    provider = docker.client2
    name = "autofunbot/tg_web_client:latest"
}

resource "docker_image" "web_client_2" {
    provider = docker.client2
    name = data.docker_registry_image.web_client_2.name
    pull_triggers = [data.docker_registry_image.web_client_2.sha256_digest]
}
resource "docker_container" "web_client_2" {
    provider = docker.client2
    name = "web-client"
    image = docker_image.web_client_2.image_id
    hostname = "web-client-2"
   
    shm_size = 2048
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["INTERVAL=5","MQTT_SERVER=mqtt-server-1-mgmt","TARGETS=web-server-2"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.88.88.100"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.121"
    }
    depends_on = ["docker_network.lan_2","docker_container.mqtt_server_1","docker_image.web_client_2","docker_network.mgmt_2"]
    
}

data "docker_registry_image" "web_server_2"{
    provider = docker.client2
    name = "autofunbot/tg_web_server:latest"
}

resource "docker_image" "web_server_2" {
    provider = docker.client2
    name = data.docker_registry_image.web_server_2.name
    pull_triggers = [data.docker_registry_image.web_server_2.sha256_digest]
}
resource "docker_container" "web_server_2" {
    provider = docker.client2
    name = "web-server"
    image = docker_image.web_server_2.image_id
    hostname = "web-server-2"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["TARGETS=web-server-2","PORT=80"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.88.88.2"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.122"
    }
    depends_on = ["docker_network.lan_2","docker_network.mgmt_2"]
    
}

data "docker_registry_image" "mqtt_server_2"{
    provider = docker.client2
    name = "eclipse-mosquitto"
}

resource "docker_image" "mqtt_server_2" {
    provider = docker.client2
    name = data.docker_registry_image.mqtt_server_2.name
    pull_triggers = [data.docker_registry_image.mqtt_server_2.sha256_digest]
}
resource "docker_container" "mqtt_server_2" {
    provider = docker.client2
    name = "mqtt-server"
    image = docker_image.mqtt_server_2.image_id
    hostname = "mqtt-server-2"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    networks_advanced {
        name = "lan"
        ipv4_address = "10.88.88.7"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.127"
    }
    depends_on = ["docker_network.lan_2","docker_network.mgmt_2"]
    
    
    mounts {
        target = "/mosquitto/config/mosquitto.conf",
        source = "/home/lab/mosquitto/mosquitto.conf",
        type = "bind"
    }
    
    
}

provider "docker" {
  alias    = "client3"
  host     = "ssh://root@desktop4-mgmt:22"
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]
}

resource "docker_network" "lan_3" {
    provider = docker.client3
    name = "lan"
    driver = "ipvlan"

    ipam_config {
        subnet = "10.66.66.0/24"
        ip_range = "10.66.66.0/24"
        gateway = "10.66.66.1"
    }
    options = {
        parent = "ens192"
        ipvlan_mode = "l2"
    }
}

resource "docker_network" "mgmt_3" {
    provider = docker.client3
    name = "mgmt"
    driver = "ipvlan"

    ipam_config {
        subnet = "192.168.10.0/24"
        ip_range = "192.168.10.0/24"
        gateway = "192.168.10.1"
    }
    options = {
        parent = "ens160"
        ipvlan_mode = "l2"
    }
}


data "docker_registry_image" "web_client_3"{
    provider = docker.client3
    name = "autofunbot/tg_web_client:latest"
}

resource "docker_image" "web_client_3" {
    provider = docker.client3
    name = data.docker_registry_image.web_client_3.name
    pull_triggers = [data.docker_registry_image.web_client_3.sha256_digest]
}
resource "docker_container" "web_client_3" {
    provider = docker.client3
    name = "web-client"
    image = docker_image.web_client_3.image_id
    hostname = "web-client-3"
   
    shm_size = 2048
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["INTERVAL=5","MQTT_SERVER=mqtt-server-1-mgmt","TARGETS=web-server-2"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.66.66.100"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.141"
    }
    depends_on = ["docker_network.lan_3","docker_container.mqtt_server_1","docker_image.web_client_3","docker_network.mgmt_3"]
    
}

data "docker_registry_image" "web_server_3"{
    provider = docker.client3
    name = "autofunbot/tg_web_server:latest"
}

resource "docker_image" "web_server_3" {
    provider = docker.client3
    name = data.docker_registry_image.web_server_3.name
    pull_triggers = [data.docker_registry_image.web_server_3.sha256_digest]
}
resource "docker_container" "web_server_3" {
    provider = docker.client3
    name = "web-server"
    image = docker_image.web_server_3.image_id
    hostname = "web-server-3"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["TARGETS=web-server-2","PORT=80"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.66.66.2"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.142"
    }
    depends_on = ["docker_network.lan_3","docker_network.mgmt_3"]
    
}

data "docker_registry_image" "mqtt_server_3"{
    provider = docker.client3
    name = "eclipse-mosquitto"
}

resource "docker_image" "mqtt_server_3" {
    provider = docker.client3
    name = data.docker_registry_image.mqtt_server_3.name
    pull_triggers = [data.docker_registry_image.mqtt_server_3.sha256_digest]
}
resource "docker_container" "mqtt_server_3" {
    provider = docker.client3
    name = "mqtt-server"
    image = docker_image.mqtt_server_3.image_id
    hostname = "mqtt-server-3"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    networks_advanced {
        name = "lan"
        ipv4_address = "10.66.66.7"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.147"
    }
    depends_on = ["docker_network.lan_3","docker_network.mgmt_3"]
    
    
    mounts {
        target = "/mosquitto/config/mosquitto.conf",
        source = "/home/lab/mosquitto/mosquitto.conf",
        type = "bind"
    }
    
    
}

provider "docker" {
  alias    = "client4"
  host     = "ssh://root@desktop5-mgmt:22"
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]
}

resource "docker_network" "lan_4" {
    provider = docker.client4
    name = "lan"
    driver = "ipvlan"

    ipam_config {
        subnet = "10.55.55.0/24"
        ip_range = "10.55.55.0/24"
        gateway = "10.55.55.1"
    }
    options = {
        parent = "ens192"
        ipvlan_mode = "l2"
    }
}

resource "docker_network" "mgmt_4" {
    provider = docker.client4
    name = "mgmt"
    driver = "ipvlan"

    ipam_config {
        subnet = "192.168.10.0/24"
        ip_range = "192.168.10.0/24"
        gateway = "192.168.10.1"
    }
    options = {
        parent = "ens160"
        ipvlan_mode = "l2"
    }
}


data "docker_registry_image" "web_client_4"{
    provider = docker.client4
    name = "autofunbot/tg_web_client:latest"
}

resource "docker_image" "web_client_4" {
    provider = docker.client4
    name = data.docker_registry_image.web_client_4.name
    pull_triggers = [data.docker_registry_image.web_client_4.sha256_digest]
}
resource "docker_container" "web_client_4" {
    provider = docker.client4
    name = "web-client"
    image = docker_image.web_client_4.image_id
    hostname = "web-client-4"
   
    shm_size = 2048
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["INTERVAL=5","MQTT_SERVER=mqtt-server-1-mgmt","TARGETS=web-server-2"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.55.55.100"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.151"
    }
    depends_on = ["docker_network.lan_4","docker_container.mqtt_server_1","docker_image.web_client_4","docker_network.mgmt_4"]
    
}

data "docker_registry_image" "web_server_4"{
    provider = docker.client4
    name = "autofunbot/tg_web_server:latest"
}

resource "docker_image" "web_server_4" {
    provider = docker.client4
    name = data.docker_registry_image.web_server_4.name
    pull_triggers = [data.docker_registry_image.web_server_4.sha256_digest]
}
resource "docker_container" "web_server_4" {
    provider = docker.client4
    name = "web-server"
    image = docker_image.web_server_4.image_id
    hostname = "web-server-4"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    env = ["TARGETS=web-server-2","PORT=80"]
    networks_advanced {
        name = "lan"
        ipv4_address = "10.55.55.2"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.152"
    }
    depends_on = ["docker_network.lan_4","docker_network.mgmt_4"]
    
}

data "docker_registry_image" "mqtt_server_4"{
    provider = docker.client4
    name = "eclipse-mosquitto"
}

resource "docker_image" "mqtt_server_4" {
    provider = docker.client4
    name = data.docker_registry_image.mqtt_server_4.name
    pull_triggers = [data.docker_registry_image.mqtt_server_4.sha256_digest]
}
resource "docker_container" "mqtt_server_4" {
    provider = docker.client4
    name = "mqtt-server"
    image = docker_image.mqtt_server_4.image_id
    hostname = "mqtt-server-4"
   
    host {
        host = "web-client-1-lan"
        ip = "10.99.99.100"
    }
   
    host {
        host = "web-client-1-mgmt"
        ip = "192.168.10.111"
    }
   
    host {
        host = "web-server-1-lan"
        ip = "10.99.99.2"
    }
   
    host {
        host = "web-server-1-mgmt"
        ip = "192.168.10.112"
    }
   
    host {
        host = "mqtt-server-1-lan"
        ip = "10.99.99.7"
    }
   
    host {
        host = "mqtt-server-1-mgmt"
        ip = "192.168.10.117"
    }
   
    host {
        host = "web-client-2-lan"
        ip = "10.88.88.100"
    }
   
    host {
        host = "web-client-2-mgmt"
        ip = "192.168.10.121"
    }
   
    host {
        host = "web-server-2-lan"
        ip = "10.88.88.2"
    }
   
    host {
        host = "web-server-2-mgmt"
        ip = "192.168.10.122"
    }
   
    host {
        host = "mqtt-server-2-lan"
        ip = "10.88.88.7"
    }
   
    host {
        host = "mqtt-server-2-mgmt"
        ip = "192.168.10.127"
    }
   
    host {
        host = "web-client-3-lan"
        ip = "10.66.66.100"
    }
   
    host {
        host = "web-client-3-mgmt"
        ip = "192.168.10.141"
    }
   
    host {
        host = "web-server-3-lan"
        ip = "10.66.66.2"
    }
   
    host {
        host = "web-server-3-mgmt"
        ip = "192.168.10.142"
    }
   
    host {
        host = "mqtt-server-3-lan"
        ip = "10.66.66.7"
    }
   
    host {
        host = "mqtt-server-3-mgmt"
        ip = "192.168.10.147"
    }
   
    host {
        host = "web-client-4-lan"
        ip = "10.55.55.100"
    }
   
    host {
        host = "web-client-4-mgmt"
        ip = "192.168.10.151"
    }
   
    host {
        host = "web-server-4-lan"
        ip = "10.55.55.2"
    }
   
    host {
        host = "web-server-4-mgmt"
        ip = "192.168.10.152"
    }
   
    host {
        host = "mqtt-server-4-lan"
        ip = "10.55.55.7"
    }
   
    host {
        host = "mqtt-server-4-mgmt"
        ip = "192.168.10.157"
    }
   
    networks_advanced {
        name = "lan"
        ipv4_address = "10.55.55.7"
    }
    networks_advanced {
        name = "mgmt"
        ipv4_address = "192.168.10.157"
    }
    depends_on = ["docker_network.lan_4","docker_network.mgmt_4"]
    
    
    mounts {
        target = "/mosquitto/config/mosquitto.conf",
        source = "/home/lab/mosquitto/mosquitto.conf",
        type = "bind"
    }
    
    
}

